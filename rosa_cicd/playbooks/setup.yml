---
# Main Playbook - ROSA CI/CD Setup

- name: Setup CI/CD Pipeline on ROSA Cluster
  hosts: rosa
  gather_facts: no
  
  vars_files:
    - ../group_vars/rosa.yml
  
  roles:
    - role: tekton
      tags: [tekton, ci]
    
    - role: argocd
      tags: [argocd, cd]
    
    - role: external_secrets
      tags: [secrets]
    
    - role: dr_worker
      tags: [dr]
  
  post_tasks:
    - name: Display Setup Information
      debug:
        msg:
          - "========================================="
          - "ROSA CI/CD Setup Complete!"
          - "========================================="
          - "Tekton Dashboard: kubectl port-forward -n {{ tekton_namespace }} svc/tekton-dashboard 9097:9097"
          - "ArgoCD UI: kubectl port-forward -n {{ argocd_namespace }} svc/argocd-server 8080:443"
          - "ECR Registry: {{ ecr_registry }}"
          - "========================================="
